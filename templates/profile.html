{{ define "tpl" }}
<div class="ui container">
	{{ if .UserID }}
		{{ $realistik := eq .UserID 1000 }}
		{{ $gqm := atoi (.Gin.Query "mode") }}
		{{ $relax := _or (atoi (.Gin.Query "rx")) (int 0)}}
		{{ $global := . }}
		{{ $UserFrozen := qb "SELECT frozen FROM users WHERE id = ?" .UserID }}
		{{ with (.Get "users/full?id=%d" .UserID) }}
			{{ $favouritemode := _or $gqm .favourite_mode }}
			<script>
				window.preferRelax = {{ $relax }};
				window.favouriteMode = {{ $favouritemode }};
				window.userID = {{ .id }};
				//swap them round on mobile so the order isnt weird for them
				document.addEventListener('DOMContentLoaded', (event) => {
					if (MobileCheck()) {
						var left = document.getElementById("left");
						var right = document.getElementById("right");

						var RightText = right.innerHTML
						right.innerHTML = left.innerHTML
						left.innerHTML = RightText;
					}
				})
			</script>
			{{ if after .silence_info.end }}
				<div class="ui error centered message">{{ $global.T "User is <b>silenced</b> for %s, expires %s." (.silence_info.reason | htmlescaper) (time .silence_info.end) | html }}</div>
			{{ end }}
			{{ if hasAdmin $global.Context.User.Privileges }}
				{{ $restr := not (has .privileges 1) }}
				{{ $disab := not (has .privileges 2) }}
				{{ $pend  := has .privileges 1048576 }}
				{{ if and $disab $restr }}
					{{ if $pend }}
						<div class="ui warning centered message">{{ $global.T "User is <b>%s</b>" "pending verification" | html }}.</div>
					{{ else }}
						<div class="ui error centered message">{{ $global.T "User is <b>%s</b>" "banned" | html }}.</div>
					{{ end }}
				{{ else if $restr }}
					<div class="ui error centered message">{{ $global.T "User is <b>%s</b>" "restricted" | html }}.</div>
				{{ else if $disab }}
					<div class="ui error centered message">{{ $global.T "User is <b>%s</b>" "locked" | html }}.</div>
				{{ else if $UserFrozen.frozen.Bool }}
					<div class="ui warning centered message">{{ $global.T "User is <b>%s</b>. This means they have to provide a liveplay or else they will be automatically restricted" "frozen" | html }}.</div>
				{{ end }}
			{{ end }}
			{{ $user := . }}
			<meta name="og:image" content="https://a.ussr.pl/{{$user.id}}"/>
			<meta property="og:type" content="website" />
			<meta property="og:url" content="https://ussr.pl/u/{{$user.id}}" />
			<meta property="og:title" content={{ $global.T "<b>%s</b>" .username}} />
			<meta property="og:description" content={{ $global.T "<b>%s</b> is a RealistikOsu! player from <b>%s</b>." .username (country .country true)}} />
			<meta property="og:image" content="https://ussr.pl/{{$user.id}}" />
			<div class="ui stackable column grid">
				<div class="ten wide column" id="left">
					{{ with $global.Get "users/userpage?id=%.0f" .id }}
						{{ if .userpage }}
							{{ with parseUserpage .userpage }}
								<div class="ui raised segment twemoji" id="userpage-content">
									{{ html . }}
								</div>
							{{ end }}
						{{ end }}
					{{ end }}
					<div id="scores-zone">
						{{ range _range 4 }}
							<div data-mode="{{ . }}" data-rx="0" {{ if _or (ne . (int $favouritemode)) (ne 0 (int $relax)) }} hidden{{ end }} data-loaded="0"></div>
							<div data-mode="{{ . }}" data-rx="1" {{ if _or (ne . (int $favouritemode)) (ne 1 (int $relax)) }} hidden{{ end }} data-loaded="0"></div>
							<div data-mode="{{ . }}" data-rx="2" {{ if _or (ne . (int $favouritemode)) (ne 2 (int $relax)) }} hidden{{ end }} data-loaded="0"></div>
						{{ end }}
						<div class="ui segment">
							<h4 class="ui horizontal divider header"><i class="star icon"></i>Achievements</h4>
							<div class="ui grid">
								<div class="eight wide column">
								  	<h2 class="ui header">
								  		<i class="play icon"></i>
								  		<div class="content">
											Playcount
											<div class="sub header">Playcount based achievements</div>
										</div>
									</h2>
								</div>
								<div class="eight wide column">
									<h2 class="ui header">
								  		<i class="forward icon"></i>
								  		<div class="content">
											Mods
											<div class="sub header">Achievements based on mod exploration</div>
								  		</div>
									</h2>
									<div id="mods-achiev"></div>
								</div> 
							</div>
							<div class="ui grid">
								<div class="eight wide column">
									<h2 class="ui header">
										<i class="music icon"></i>
										<div class="content">
										  Combo
										  <div class="sub header">Consistency based achievements</div>
									  </div>
								  </h2>
								  <div id="combo-achiev"></div>
							  </div>
							  <div class="eight wide column">
								<h2 class="ui header">
									<i class="star icon"></i>
									<div class="content">
									  Star Rating
									  <div class="sub header">Achievements based on exploring new difficulties</div>
								  </div>
							  </h2>
							  <div id="sr-achiev"></div>
						  </div>
							</div>
						</div>
					</div>
					<div class="ui modal">
						<i class="close icon"></i>
						<div class="content">
							<table class="ui definition table" id="score-data-table">
							</table>
						</div>
					</div>
				</div>
				<div class="six wide column" id="right">
					<div style="margin: 0 !important;padding: 0;text-align: center;" class="ui top attached segment auto">
						<div style="margin: 0;filter: blur(5p);">
							<div style="background-image: url(/static/image/banner_bg.png);min-height: 200px;width: 100%;background-size: cover;background-position: center;box-shadow: 0px 5px 10px #090909;" class="">
								<div style="/*! text-align: left; */padding: 2px;font-size: 25px;background-color: #0000009c;/*! transform: translateY(-50%); */">
									<i class="trophy line small circular icon"></i> 
									{{ range $kp, $vp := (slice .stats.vn .stats.rx .stats.ap) }}
										{{ range $k, $v := (slice $vp.std $vp.taiko $vp.ctb $vp.mania) }}
										<span data-rx="{{ $kp }}" data-mode="{{ $k }}"{{ if _or (ne $k (int $favouritemode)) (ne $kp (int $relax)) }} hidden{{ end }}>
											{{ with and $v $v.global_leaderboard_rank }}
												#{{ . }}
											{{ else }}
												{{ $global.T "Unknown" }}
											{{ end }}</span>
										{{ end }}
									{{ end }}
								</div>
							</div>
						</div>
						<!--Profile image-->
						<!-- We will use delta api here so well just create div with id and allow js to do a job. -->
						<div id="avatar-canvas">
							</div>
						<!--Hello fellow developers! Please do not steal this like you did with the score beatmap images.
						At least if you do, please credit me (RealistikDash) in your team changes. I know who did it as
						I have a very distinct code style.
						Plus your implementations did not remove the rosu specific theme aspects, meaning they were
						direct copies without adaptations for your site.
						-->
						<!--Bottom part-->
						<div style="margin-top: 1rem;margin-bottom: 1rem;">

							<h1 id="rainbow" class="ui header">
								<span id="highlight" style="font-size: 40px;font-weight:normal;">{{ .username }}</span>
							</h1>
							{{ $oof := . }}
							{{ if eq $oof.clan.name "" }}
							<!--HOW DO I INVERT IN GOLANG??-->
							{{ else }}
							<span style="font-size: 20px;">{{ $global.T "%s" ($oof.clan.name) }}</span>
							{{ end }}

							{{ if _or (has .privileges 8) (has .privileges 4) }}
							<script>
							var text='{{ .username }}'
							if (document.all||document.getElementById){
								var storetext=document.getElementById? document.getElementById("highlight") : document.all.highlight
							}
							else
							document.write(text)
							var hex=new Array("00","14","28","3C","50","64","78","8C","A0","B4","C8","DC","F0")
							var r=1
							var g=1
							var b=1
							var seq=1
							function changetext(){
								rainbow="#"+hex[r]+hex[g]+hex[b]
								storetext.style.color=rainbow
							}
							function change() {
								if (seq==6){
								b--
								if (b==0)
								seq=1
								}
								if (seq==5){
								r++
								if (r==12)
								seq=6
								}
								if (seq==4){
								g--
								if (g==0)
								seq=5
								}
								if (seq==3){
								b++
								if (b==12)
								seq=4
								}
								if (seq==2){
								r--
								if (r==0)
								seq=3
								}
								if (seq==1){
								g++
								if (g==12)
								seq=2
							}
							changetext()
							}
							function starteffect() {
								if (document.all||document.getElementById)
									{{ if (has .privileges 8) }}
									document.getElementById('rainbow').style.background = "url(/static/image/rainbow.webp)";
									{{ else }}
									document.getElementById('rainbow').style.background = "url(/static/image/supporter.gif)";
									{{ end }}
									document.getElementById('rainbow').style["-webkit-background-clip"] = "text";
									document.getElementById('rainbow').style.backgroundClip = "text";
									document.getElementById('rainbow').style.color = "transparent";
							}
							starteffect()
							</script>
							{{ end }}
							<!--BADGES!!! THIS WILL BE HELL PLEASE HELP.-->
							<div class="" style="font-size: 2rem;margin-top: 11px;">
								{{ if .badges }}
									{{ range .badges }}
										<span class data-tooltip="{{ .name }}" data-inverted="">
											<i class="{{ faIcon .icon }} small icon circular"></i>
										</span>
									{{ end }}
								{{ end }}
								{{ if .custom_badge  }}
									{{ with .custom_badge }}
										<span class data-tooltip="{{ .name }}" data-inverted="">
											<i class="{{ faIcon .icon }} small icon circular"></i>
										</span>
									{{ end }}
								{{ end }}
							</div>
							<!--Cool Buttons for cool stuff.-->
							<div style="margin: 10px">
								<!--<a href="#" class="ui button blue inverted">Add Friend</a>-->
								{{ if hasAdmin $global.Context.User.Privileges }}
								<a href="https://old.ussr.pl/user/edit/{{ $global.UserID }}" class="ui button red inverted">Edit User</a>
								{{ end }}
								{{ if eq $global.UserID $global.Context.User.ID }}
								<a href="/settings/avatar" class="ui button inverted purple">Change Avatar</a>
								{{ end }}
							</div>
						</div>
					</div>
					<div class="ui three item bottom attached menu" id="rx-menu" style="margin-bottom: 0;">
						<a class="0 item {{ if eq 0 (int $relax) }}active{{ end }}" data-rx="0" href="/u/{{ $user.id }}?mode={{ $favouritemode }}&rx=0">Vanilla</a>
						<a class="1 item {{ if eq 1 (int $relax) }}active{{ end }}" data-rx="1" href="/u/{{ $user.id }}?mode={{ $favouritemode }}&rx=1">Relax</a>
						<a class="1 item {{ if eq 2 (int $relax) }}active{{ end }}" data-rx="2" href="/u/{{ $user.id }}?mode={{ $favouritemode }}&rx=2">Autopilot</a>
					</div>
					<div class="ui four item bottom attached menu" id="mode-menu">
						{{ range $k, $v := modes }}
							<a class="{{ favMode $favouritemode $k }}item" data-mode="{{ $k }}" href="/u/{{ $user.id }}?mode={{ $k }}&rx={{ $relax }}">{{ $v }}</a>
						{{ end }}
					</div>
					<!--Rank Graph-->
					<div class="ui segment">
						<h2 class="ui header" style="margin: 0; margin-bottom:10px">	Rank Graph</h2>
						<canvas id="ProfileGraph" height="130"></canvas>
					</div>
					<div class="ui segment">
						<div class="" style="margin-bottom: 1.5rem;">				
								
							{{ $global.T "<b>%s</b> is a" .username | html}} 

							{{ $owner := (has .privileges 3145727) }}
							{{ $cm := (has .privileges 2883911) }}
							{{ $admin := (has .privileges 1048575) }}
							{{ $dev := (has .privileges 1043995) }}
							{{ $bat := (has .privileges 267) }}
							{{ $member := (has .privileges 3) }}
							
							{{ if $owner }}
							{{ $global.T "RealistikOsu! %s" "Owner" }}
							{{ else }}
							{{ if $cm }}
							{{ $global.T "RealistikOsu! %s" "Community Manager" }}
							{{ else }}
							{{ if $admin }}
							{{ $global.T "RealistikOsu! %s" "Admin" }}
							{{ else }}
							{{ if $dev }}
							{{ $global.T "RealistikOsu! %s" "Developer" }}
							{{ else }}
							{{ if $bat }}
							{{ $global.T "RealistikOsu! %s" "BAT" }}
							{{ else }}
							{{ if $member }}
							{{ $global.T "RealistikOsu! %s" "Player" }}
							{{ else }}
							{{end}}{{end}}{{end}}{{end}}{{end}}{{end}}

							{{ $global.T "from <b>%s</b>." (country .country true) | html }}
							<br>{{ $global.T "They signed up on RealistikOsu! %s." (time $user.registered_on) | html }}
							<br>{{ $global.T "Last seen: %s." (time $user.latest_activity) | html }}
							<br>{{ with playstyle .play_style $global }}{{ $global.T "They play with %s." . }}{{ end }}
						</div>
						{{ range $rxk, $rxv := (slice .stats.vn .stats.rx .stats.ap) }}
						{{ range $k, $v := (slice $rxv.std $rxv.taiko $rxv.ctb $rxv.mania) }}
						{{ $maxcombo := qb "SELECT FORMAT(scores.max_combo,0) AS combo FROM scores WHERE userid = ? ORDER BY max_combo DESC;" $.UserID }}
							<div data-mode="{{ $k }}" data-rx="{{ $rxk }}" {{ if _or (ne $k (int $favouritemode)) (ne $rxk (int $relax)) }} hidden{{ end }}>
								<table class="ui very basic two column compact table nopad">
									<tbody>
										{{ with .global_leaderboard_rank }}
											<tr>
												<td><b>{{ $global.T "Global rank" }}</b></td>
												<td class="right aligned">#{{ . }}</td>
											</tr>
										{{ end }}
										{{ with .country_leaderboard_rank }}
											<tr>
												<td><b>{{ $global.T "Country rank" }} &nbsp;{{ country $user.country false }}</b></td>
												<td class="right aligned">#{{ . }}</td>
											</tr>
										{{ end }}
										<tr>
											<td><b>{{ $global.T "PP" }}</b></td>
											<td class="right aligned">{{ humanize .pp }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Ranked score" }}</b></td>
											<td class="right aligned">{{ humanize .ranked_score }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Total score" }}</b></td>
											<td class="right aligned">{{ humanize .total_score }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Playcount" }}</b></td>
											<td class="right aligned">{{ humanize .playcount }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Maximum Combo" }}</b></td>
											<td class="right aligned">{{ $maxcombo.combo }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Followers" }}</b></td>
											<td class="right aligned">{{ with $.Get "users/followers?userid=%d" $.UserID }} {{ .subscount }} {{ end }} </td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Replays watched" }}</b></td>
											<td class="right aligned">{{ humanize .replays_watched }}</td>
										</tr>
										<tr>
											<td><b>{{ $global.T "Total hits" }}</b></td>
											<td class="right aligned">{{ humanize .total_hits }}</td>
										</tr>									<tr>
											<td><b>{{ $global.T "Accuracy" }}</b></td>
											<td class="right aligned">{{ printf "%.2f" .accuracy }}%</td>
										</tr>
									</tbody>
								</table>
								<div class="ui blue progress little margin top" data-percent="{{ levelPercent .level }}">
									<div class="bar">
										<div class="progress">{{ levelPercent .level }}%</div>
									</div>
									<div class="label">{{ $global.T "Level %s" (level .level) }}</div>
								</div>
							</div>
						{{ end }}
						{{ end }}
					</div>
				</div>
			</div>
		{{ end }}
	{{ end }}
</div>
{{ end }}
